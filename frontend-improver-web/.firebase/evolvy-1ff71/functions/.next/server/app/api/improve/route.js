"use strict";(()=>{var e={};e.id=162,e.ids=[162],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},73837:e=>{e.exports=require("util")},35001:(e,t,s)=>{let n,r,i;s.r(t),s.d(t,{headerHooks:()=>nw,originalPathname:()=>nb,patchFetch:()=>nv,requestAsyncStorage:()=>nm,routeModule:()=>nf,serverHooks:()=>ny,staticGenerationAsyncStorage:()=>ng,staticGenerationBailout:()=>n_});var a,o,l,c,u,h,d,p,f,m,g,y,w,_,b,v,x,S,$,A,I,O,R,k,E,P,C,T,N,j,M,L,D,B,q,U,W,F,X,J,H,K,V,z,G,Y,Q,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eu,eh,ed,ep,ef,em,eg,ey,ew,e_,eb,ev,ex={};s.r(ex),s.d(ex,{GET:()=>no});var eS=s(95419),e$=s(69108),eA=s(99678);let eI=require("child_process");var eO=s(73837),eR=s(71017),ek=s.n(eR),eE=s(57147),eP=s.n(eE);function eC(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eT(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eN=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eN=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^s()&15>>+e/4).toString(16))};function ej(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eM=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eL extends Error{}class eD extends eL{constructor(e,t,s,n){super(`${eD.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eq({message:s,cause:eM(t)});let r=t?.error;return 400===e?new eW(e,r,s,n):401===e?new eF(e,r,s,n):403===e?new eX(e,r,s,n):404===e?new eJ(e,r,s,n):409===e?new eH(e,r,s,n):422===e?new eK(e,r,s,n):429===e?new eV(e,r,s,n):e>=500?new ez(e,r,s,n):new eD(e,r,s,n)}}class eB extends eD{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eq extends eD{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eU extends eq{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eW extends eD{}class eF extends eD{}class eX extends eD{}class eJ extends eD{}class eH extends eD{}class eK extends eD{}class eV extends eD{}class ez extends eD{}class eG extends eL{constructor(){super("Could not parse response content as the length limit was reached")}}class eY extends eL{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}let eQ=/^[a-z][a-z0-9+.-]*:/i,eZ=e=>eQ.test(e);function e0(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e1=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eL(`${e} must be an integer`);if(t<0)throw new eL(`${e} must be a positive integer`);return t},e2=e=>{try{return JSON.parse(e)}catch(e){return}},e3=e=>new Promise(t=>setTimeout(t,e)),e4={off:0,error:200,warn:300,info:400,debug:500},e8=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(e4,e))return e;te(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(e4))}`)}};function e5(){}function e6(e,t,s){return!t||e4[e]>e4[s]?e5:t[e].bind(t)}let e9={error:e5,warn:e5,info:e5,debug:e5},e7=new WeakMap;function te(e){let t=e.logger,s=e.logLevel??"off";if(!t)return e9;let n=e7.get(t);if(n&&n[0]===s)return n[1];let r={error:e6("error",t,s),warn:e6("warn",t,s),info:e6("info",t,s),debug:e6("debug",t,s)};return e7.set(t,[s,r]),r}let tt=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e),ts="5.1.0",tn=()=>!1,tr=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ts,"X-Stainless-OS":ta(Deno.build.os),"X-Stainless-Arch":ti(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ts,"X-Stainless-OS":ta(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ti(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ts,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},ti=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ta=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",to=()=>n??(n=tr());function tl(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function tc(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return tl({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function tu(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function th(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let td=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),tp="RFC3986",tf={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},tm=(Object.prototype.hasOwnProperty,Array.isArray),tg=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function ty(e,t){if(tm(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tw=Object.prototype.hasOwnProperty,t_={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tb=Array.isArray,tv=Array.prototype.push,tx=function(e,t){tv.apply(e,tb(t)?t:[t])},tS=Date.prototype.toISOString,t$={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tg[n];continue}if(n<2048){s[s.length]=tg[192|n>>6]+tg[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tg[224|n>>12]+tg[128|n>>6&63]+tg[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tg[240|n>>18]+tg[128|n>>12&63]+tg[128|n>>6&63]+tg[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:tp,formatter:tf[tp],indices:!1,serializeDate:e=>tS.call(e),skipNulls:!1,strictNullHandling:!1},tA={};function tI(e){let t;return(r??(r=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tO(e){let t;return(i??(i=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tR{constructor(){a.set(this,void 0),o.set(this,void 0),eC(this,a,new Uint8Array,"f"),eC(this,o,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tI(e):e;eC(this,a,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eT(this,a,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eT(this,a,"f"),eT(this,o,"f")));){if(t.carriage&&null==eT(this,o,"f")){eC(this,o,t.index,"f");continue}if(null!=eT(this,o,"f")&&(t.index!==eT(this,o,"f")+1||t.carriage)){n.push(tO(eT(this,a,"f").subarray(0,eT(this,o,"f")-1))),eC(this,a,eT(this,a,"f").subarray(eT(this,o,"f")),"f"),eC(this,o,null,"f");continue}let e=null!==eT(this,o,"f")?t.preceding-1:t.preceding,s=tO(eT(this,a,"f").subarray(0,e));n.push(s),eC(this,a,eT(this,a,"f").subarray(t.index),"f"),eC(this,o,null,"f")}return n}flush(){return eT(this,a,"f").length?this.decode("\n"):[]}}a=new WeakMap,o=new WeakMap,tR.NEWLINE_CHARS=new Set(["\n","\r"]),tR.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class tk{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new tk(async function*(){if(s)throw new eL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(let s of tE(e,t))if(!n){if(s.data.startsWith("[DONE]")){n=!0;continue}if(null===s.event||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let t;try{t=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(t&&t.error)throw new eD(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new eD(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}}n=!0}catch(e){if(ej(e))return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let s=!1;async function*n(){let t=new tR;for await(let s of tu(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tk(async function*(){if(s)throw new eL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ej(e))return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tk(()=>n(e),this.controller),new tk(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this;return tl({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tI(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tE(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eL("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eL("Attempted to iterate over a response with no body")}let s=new tC,n=new tR;for await(let t of tP(tu(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tP(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tI(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tC{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(t);return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function tT(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(te(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):tk.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tN(await s.json(),s):await s.text()})();return te(e).debug(`[${n}] response parsed`,tt({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tN(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tj extends Promise{constructor(e,t,s=tT){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,l.set(this,void 0),eC(this,l,e,"f")}_thenUnwrap(e){return new tj(eT(this,l,"f"),this.responsePromise,async(t,s)=>tN(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eT(this,l,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}l=new WeakMap;class tM{constructor(e,t,s,n){c.set(this,void 0),eC(this,c,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eL("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eT(this,c,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(c=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tL extends tj{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tT(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tD extends tM{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tB extends tM{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:s}}:null}}let tq=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tU(e,t,s){return tq(),new File(e,t??"unknown_file",s)}function tW(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tF=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tX=async(e,t)=>({...e,body:await tH(e.body,t)}),tJ=new WeakMap,tH=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tJ.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tJ.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tG(s,e,t))),s},tK=e=>e instanceof Blob&&"name"in e,tV=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tF(e)||tK(e)),tz=e=>{if(tV(e))return!0;if(Array.isArray(e))return e.some(tz);if(e&&"object"==typeof e){for(let t in e)if(tz(e[t]))return!0}return!1},tG=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tU([await s.blob()],tW(s)));else if(tF(s))e.append(t,tU([await new Response(tc(s)).blob()],tW(s)));else if(tK(s))e.append(t,s,tW(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tG(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tG(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tY=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tQ=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tY(e),tZ=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function t0(e,t,s){if(tq(),tQ(e=await e))return e instanceof File?e:tU([await e.arrayBuffer()],e.name);if(tZ(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tU(await t1(n),t,s)}let n=await t1(e);if(t||(t=tW(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tU(n,t,s)}async function t1(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tY(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tF(e))for await(let s of e)t.push(...await t1(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t2{constructor(e){this._client=e}}function t3(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t4=((e=t3)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=t.reduce((t,n,i)=>(/[?#]/.test(n)&&(r=!0),t+n+(i===s.length?"":(r?encodeURIComponent:e)(String(s[i])))),""),a=i.split(/[?#]/,1)[0],o=[],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(a));)o.push({start:n.index,length:n[0].length});if(o.length>0){let e=0,t=o.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eL(`Path parameters result in path with invalid segments:
${i}
${t}`)}return i})(t3);class t8 extends t2{list(e,t={},s){return this._client.getAPIList(t4`/chat/completions/${e}/messages`,tB,{query:t,...s})}}let t5=e=>e?.role==="assistant",t6=e=>e?.role==="tool";class t9{constructor(){u.add(this),this.controller=new AbortController,h.set(this,void 0),d.set(this,()=>{}),p.set(this,()=>{}),f.set(this,void 0),m.set(this,()=>{}),g.set(this,()=>{}),y.set(this,{}),w.set(this,!1),_.set(this,!1),b.set(this,!1),v.set(this,!1),eC(this,h,new Promise((e,t)=>{eC(this,d,e,"f"),eC(this,p,t,"f")}),"f"),eC(this,f,new Promise((e,t)=>{eC(this,m,e,"f"),eC(this,g,t,"f")}),"f"),eT(this,h,"f").catch(()=>{}),eT(this,f,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eT(this,u,"m",x).bind(this))},0)}_connected(){this.ended||(eT(this,d,"f").call(this),this._emit("connect"))}get ended(){return eT(this,w,"f")}get errored(){return eT(this,_,"f")}get aborted(){return eT(this,b,"f")}abort(){this.controller.abort()}on(e,t){return(eT(this,y,"f")[e]||(eT(this,y,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eT(this,y,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eT(this,y,"f")[e]||(eT(this,y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eC(this,v,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eC(this,v,!0,"f"),await eT(this,f,"f")}_emit(e,...t){if(eT(this,w,"f"))return;"end"===e&&(eC(this,w,!0,"f"),eT(this,m,"f").call(this));let s=eT(this,y,"f")[e];if(s&&(eT(this,y,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eT(this,v,"f")||s?.length||Promise.reject(e),eT(this,p,"f").call(this,e),eT(this,g,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eT(this,v,"f")||s?.length||Promise.reject(e),eT(this,p,"f").call(this,e),eT(this,g,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function t7(e){return e?.$brand==="auto-parseable-response-format"}function se(e){return e?.$brand==="auto-parseable-tool"}function st(e,t){let s=e.choices.map(e=>{var s;if("length"===e.finish_reason)throw new eG;if("content_filter"===e.finish_reason)throw new eY;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:se(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(s):JSON.parse(s):null):null}}});return{...e,choices:s}}function ss(e){return!!t7(e.response_format)||(e.tools?.some(e=>se(e)||"function"===e.type&&!0===e.function.strict)??!1)}h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,u=new WeakSet,x=function(e){if(eC(this,_,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eB),e instanceof eB)return eC(this,b,!0,"f"),this._emit("abort",e);if(e instanceof eL)return this._emit("error",e);if(e instanceof Error){let t=new eL(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eL(String(e)))};class sn extends t9{constructor(){super(...arguments),S.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t6(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t5(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eL("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eT(this,S,"m",$).call(this)}async finalMessage(){return await this.done(),eT(this,S,"m",A).call(this)}async finalFunctionToolCall(){return await this.done(),eT(this,S,"m",I).call(this)}async finalFunctionToolCallResult(){return await this.done(),eT(this,S,"m",O).call(this)}async totalUsage(){return await this.done(),eT(this,S,"m",R).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eT(this,S,"m",A).call(this);t&&this._emit("finalMessage",t);let s=eT(this,S,"m",$).call(this);s&&this._emit("finalContent",s);let n=eT(this,S,"m",I).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eT(this,S,"m",O).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eT(this,S,"m",R).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eT(this,S,"m",k).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(st(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(se(e)){if(!e.$callback)throw new eL("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let h="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:h,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eL("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=u[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eT(this,S,"m",E).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}S=new WeakSet,$=function(){return eT(this,S,"m",A).call(this).content??null},A=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t5(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eL("stream ended without producing a ChatCompletionMessage with role=assistant")},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t5(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},O=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t6(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},R=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},k=function(e){if(null!=e.n&&e.n>1)throw new eL("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},E=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class sr extends sn{static runTools(e,t,s){let n=new sr,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),t5(e)&&e.content&&this._emit("content",e.content)}}let si={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class sa extends Error{}class so extends Error{}let sl=(e,t)=>{let s=e.length,n=0,r=e=>{throw new sa(`${e} at position ${n}`)},i=e=>{throw new so(`${e} at position ${n}`)},a=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||si.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||si.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||si.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||si.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||si.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||si.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(si.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,h();let i={};try{for(;"}"!==e[n];){if(h(),n>=s&&si.OBJ&t)return i;let r=o();h(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(si.OBJ&t)return i;throw e}h(),","===e[n]&&n++}}catch(e){if(si.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),h(),","===e[n]&&n++}catch(e){if(si.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&si.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(si.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||si.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&si.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},h=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},sc=e=>(function(e,t=si.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sl(e.trim(),t)})(e,si.ALL^si.NUM);class su extends sn{constructor(e){super(),P.add(this),C.set(this,void 0),T.set(this,void 0),N.set(this,void 0),eC(this,C,e,"f"),eC(this,T,[],"f")}get currentChatCompletionSnapshot(){return eT(this,N,"f")}static fromReadableStream(e){let t=new su(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new su(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eT(this,P,"m",j).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eT(this,P,"m",L).call(this,e);if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eT(this,P,"m",q).call(this))}async _fromReadableStream(e,t){let s;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eT(this,P,"m",j).call(this),this._connected();let r=tk.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eT(this,P,"m",q).call(this)),eT(this,P,"m",L).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eT(this,P,"m",q).call(this))}[(C=new WeakMap,T=new WeakMap,N=new WeakMap,P=new WeakSet,j=function(){this.ended||eC(this,N,void 0,"f")},M=function(e){let t=eT(this,T,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eT(this,T,"f")[e.index]=t),t},L=function(e){if(this.ended)return;let t=eT(this,P,"m",W).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eT(this,P,"m",M).call(this,e);for(let t of(e.finish_reason&&(eT(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eT(this,P,"m",D).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eT(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eT(this,P,"m",D).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},D=function(e,t){if(eT(this,P,"m",M).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eT(this,C,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:se(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},B=function(e){let t=eT(this,P,"m",M).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eT(this,P,"m",U).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},q=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");let e=eT(this,N,"f");if(!e)throw new eL("request ended without sending any chunks");return eC(this,N,void 0,"f"),eC(this,T,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eL(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new eL(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eL(`missing function_call.arguments for choice ${n}`);if(!l)throw new eL(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...u}=r||{};if(null==a)throw new eL(`missing choices[${n}].tool_calls[${s}].id
${sh(e)}`);if(null==i)throw new eL(`missing choices[${n}].tool_calls[${s}].type
${sh(e)}`);if(null==c)throw new eL(`missing choices[${n}].tool_calls[${s}].function.name
${sh(e)}`);if(null==l)throw new eL(`missing choices[${n}].tool_calls[${s}].function.arguments
${sh(e)}`);return{...o,id:a,type:i,function:{...u,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&ss(t)?st(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eT(this,C,"f"))},U=function(){let e=eT(this,C,"f")?.response_format;return t7(e)?e:null},W=function(e){var t,s,n,r;let i=eT(this,N,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...h}of(i?Object.assign(i,o):i=eC(this,N,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...h}),u){if(e.logprobs){let{content:n,refusal:r,...i}=u;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,eT(this,C,"f")&&ss(eT(this,C,"f")))){if("length"===l)throw new eG;if("content_filter"===l)throw new eY}if(Object.assign(e,h),!a)continue;let{content:o,refusal:d,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eT(this,P,"m",U).call(this)&&(e.message.parsed=sc(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return se(s)||s?.function.strict||!1}(eT(this,C,"f"),o)&&(o.function.parsed_arguments=sc(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tk(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sh(e){return JSON.stringify(e)}class sd extends su{static fromReadableStream(e){let t=new sd(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sd(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sp extends t2{constructor(){super(...arguments),this.messages=new t8(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(t4`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(t4`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tB,{query:e,...t})}delete(e,t){return this._client.delete(t4`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new eL(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eL(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>st(t,e))}runTools(e,t){return e.stream?sd.runTools(this._client,e,t):sr.runTools(this._client,e,t)}stream(e,t){return su.createChatCompletion(this._client,e,t)}}sp.Messages=t8;class sf extends t2{constructor(){super(...arguments),this.completions=new sp(this._client)}}sf.Completions=sp;let sm=Symbol("brand.privateNullableHeaders"),sg=Array.isArray,sy=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sm in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():sg(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=sg(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sm]:!0,values:t,nulls:s}};class sw extends t2{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sy([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class s_ extends t2{create(e,t){return this._client.post("/audio/transcriptions",tX({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sb extends t2{create(e,t){return this._client.post("/audio/translations",tX({body:e,...t,__metadata:{model:e.model}},this._client))}}class sv extends t2{constructor(){super(...arguments),this.transcriptions=new s_(this._client),this.translations=new sb(this._client),this.speech=new sw(this._client)}}sv.Transcriptions=s_,sv.Translations=sb,sv.Speech=sw;class sx extends t2{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t4`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tB,{query:e,...t})}cancel(e,t){return this._client.post(t4`/batches/${e}/cancel`,t)}}class sS extends t2{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t4`/assistants/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t4`/assistants/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tB,{query:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t4`/assistants/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class s$ extends t2{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sA extends t2{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sI extends t2{constructor(){super(...arguments),this.sessions=new s$(this._client),this.transcriptionSessions=new sA(this._client)}}sI.Sessions=s$,sI.TranscriptionSessions=sA;class sO extends t2{create(e,t,s){return this._client.post(t4`/threads/${e}/messages`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t4`/threads/${n}/messages/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t4`/threads/${n}/messages/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t4`/threads/${e}/messages`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(t4`/threads/${n}/messages/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sR extends t2{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(t4`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(t4`/threads/${n}/runs/${e}/steps`,tB,{query:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sk=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}};class sE extends t9{constructor(){super(...arguments),F.add(this),J.set(this,[]),H.set(this,{}),K.set(this,{}),V.set(this,void 0),z.set(this,void 0),G.set(this,void 0),Y.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0)}[(J=new WeakMap,H=new WeakMap,K=new WeakMap,V=new WeakMap,z=new WeakMap,G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,F=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new X;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tk.fromReadableStream(e,this.controller);for await(let e of n)eT(this,F,"m",en).call(this,e);if(n.controller.signal?.aborted)throw new eB;return this._addRun(eT(this,F,"m",er).call(this))}toReadableStream(){return new tk(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new X;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eT(this,F,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eT(this,F,"m",er).call(this))}static createThreadAssistantStream(e,t,s){let n=new X;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new X;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eT(this,ee,"f")}currentRun(){return eT(this,et,"f")}currentMessageSnapshot(){return eT(this,V,"f")}currentRunStepSnapshot(){return eT(this,es,"f")}async finalRunSteps(){return await this.done(),Object.values(eT(this,H,"f"))}async finalMessages(){return await this.done(),Object.values(eT(this,K,"f"))}async finalRun(){if(await this.done(),!eT(this,z,"f"))throw Error("Final run was not received.");return eT(this,z,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eT(this,F,"m",en).call(this,e);if(i.controller.signal?.aborted)throw new eB;return this._addRun(eT(this,F,"m",er).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eT(this,F,"m",en).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eT(this,F,"m",er).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e0(t)&&e0(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e0(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}X=sE,en=function(e){if(!this.ended)switch(eC(this,ee,e,"f"),eT(this,F,"m",eo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eT(this,F,"m",eh).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eT(this,F,"m",ea).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eT(this,F,"m",ei).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},er=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");if(!eT(this,z,"f"))throw Error("Final run has not been received");return eT(this,z,"f")},ei=function(e){let[t,s]=eT(this,F,"m",ec).call(this,e,eT(this,V,"f"));for(let e of(eC(this,V,t,"f"),eT(this,K,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eT(this,G,"f")){if(eT(this,Y,"f"))switch(eT(this,Y,"f").type){case"text":this._emit("textDone",eT(this,Y,"f").text,eT(this,V,"f"));break;case"image_file":this._emit("imageFileDone",eT(this,Y,"f").image_file,eT(this,V,"f"))}eC(this,G,s.index,"f")}eC(this,Y,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eT(this,G,"f")){let t=e.data.content[eT(this,G,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eT(this,V,"f"));break;case"text":this._emit("textDone",t.text,eT(this,V,"f"))}}eT(this,V,"f")&&this._emit("messageDone",e.data),eC(this,V,void 0,"f")}},ea=function(e){let t=eT(this,F,"m",el).call(this,e);switch(eC(this,es,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eT(this,Q,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eT(this,Z,"f")&&this._emit("toolCallDone",eT(this,Z,"f")),eC(this,Q,e.index,"f"),eC(this,Z,t.step_details.tool_calls[e.index],"f"),eT(this,Z,"f")&&this._emit("toolCallCreated",eT(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eC(this,es,void 0,"f"),"tool_calls"==e.data.step_details.type&&eT(this,Z,"f")&&(this._emit("toolCallDone",eT(this,Z,"f")),eC(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t)}},eo=function(e){eT(this,J,"f").push(e),this._emit("event",e)},el=function(e){switch(e.event){case"thread.run.step.created":return eT(this,H,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eT(this,H,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=X.accumulateDelta(t,s.delta);eT(this,H,"f")[e.data.id]=n}return eT(this,H,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eT(this,H,"f")[e.data.id]=e.data}if(eT(this,H,"f")[e.data.id])return eT(this,H,"f")[e.data.id];throw Error("No snapshot available")},ec=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eT(this,F,"m",eu).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eu=function(e,t){return X.accumulateDelta(t,e)},eh=function(e){switch(eC(this,et,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":eC(this,z,e.data,"f"),eT(this,Z,"f")&&(this._emit("toolCallDone",eT(this,Z,"f")),eC(this,Z,void 0,"f"))}};class sP extends t2{constructor(){super(...arguments),this.steps=new sR(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(t4`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t4`/threads/${n}/runs/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t4`/threads/${n}/runs/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t4`/threads/${e}/runs`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(t4`/threads/${n}/runs/${e}/cancel`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sE.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sE.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t4`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sE.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sP.Steps=sR;class sC extends t2{constructor(){super(...arguments),this.runs=new sP(this._client),this.messages=new sO(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t4`/threads/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t4`/threads/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(t4`/threads/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sE.createThreadAssistantStream(e,this._client.beta.threads,t)}}sC.Runs=sP,sC.Messages=sO;class sT extends t2{constructor(){super(...arguments),this.realtime=new sI(this._client),this.assistants=new sS(this._client),this.threads=new sC(this._client)}}sT.Realtime=sI,sT.Assistants=sS,sT.Threads=sC;class sN extends t2{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sj extends t2{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t4`/containers/${n}/files/${e}/content`,{...s,headers:sy([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sM extends t2{constructor(){super(...arguments),this.content=new sj(this._client)}create(e,t,s){return this._client.post(t4`/containers/${e}/files`,tX({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t4`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t4`/containers/${e}/files`,tB,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(t4`/containers/${n}/files/${e}`,{...s,headers:sy([{Accept:"*/*"},s?.headers])})}}sM.Content=sj;class sL extends t2{constructor(){super(...arguments),this.files=new sM(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(t4`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tB,{query:e,...t})}delete(e,t){return this._client.delete(t4`/containers/${e}`,{...t,headers:sy([{Accept:"*/*"},t?.headers])})}}sL.Files=sM;class sD extends t2{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&te(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(te(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sk(t)}),e)))}}class sB extends t2{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(t4`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(t4`/evals/${n}/runs/${e}/output_items`,tB,{query:r,...s})}}class sq extends t2{constructor(){super(...arguments),this.outputItems=new sB(this._client)}create(e,t,s){return this._client.post(t4`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(t4`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t4`/evals/${e}/runs`,tB,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(t4`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(t4`/evals/${n}/runs/${e}`,s)}}sq.OutputItems=sB;class sU extends t2{constructor(){super(...arguments),this.runs=new sq(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(t4`/evals/${e}`,t)}update(e,t,s){return this._client.post(t4`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tB,{query:e,...t})}delete(e,t){return this._client.delete(t4`/evals/${e}`,t)}}sU.Runs=sq;class sW extends t2{create(e,t){return this._client.post("/files",tX({body:e,...t},this._client))}retrieve(e,t){return this._client.get(t4`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tB,{query:e,...t})}delete(e,t){return this._client.delete(t4`/files/${e}`,t)}content(e,t){return this._client.get(t4`/files/${e}/content`,{...t,headers:sy([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e3(t),i=await this.retrieve(e),Date.now()-r>s)throw new eU({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sF extends t2{}class sX extends t2{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sJ extends t2{constructor(){super(...arguments),this.graders=new sX(this._client)}}sJ.Graders=sX;class sH extends t2{create(e,t,s){return this._client.getAPIList(t4`/fine_tuning/checkpoints/${e}/permissions`,tD,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(t4`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(t4`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class sK extends t2{constructor(){super(...arguments),this.permissions=new sH(this._client)}}sK.Permissions=sH;class sV extends t2{list(e,t={},s){return this._client.getAPIList(t4`/fine_tuning/jobs/${e}/checkpoints`,tB,{query:t,...s})}}class sz extends t2{constructor(){super(...arguments),this.checkpoints=new sV(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(t4`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tB,{query:e,...t})}cancel(e,t){return this._client.post(t4`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(t4`/fine_tuning/jobs/${e}/events`,tB,{query:t,...s})}pause(e,t){return this._client.post(t4`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(t4`/fine_tuning/jobs/${e}/resume`,t)}}sz.Checkpoints=sV;class sG extends t2{constructor(){super(...arguments),this.methods=new sF(this._client),this.jobs=new sz(this._client),this.checkpoints=new sK(this._client),this.alpha=new sJ(this._client)}}sG.Methods=sF,sG.Jobs=sz,sG.Checkpoints=sK,sG.Alpha=sJ;class sY extends t2{}class sQ extends t2{constructor(){super(...arguments),this.graderModels=new sY(this._client)}}sQ.GraderModels=sY;class sZ extends t2{createVariation(e,t){return this._client.post("/images/variations",tX({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tX({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class s0 extends t2{retrieve(e,t){return this._client.get(t4`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tD,e)}delete(e,t){return this._client.delete(t4`/models/${e}`,t)}}class s1 extends t2{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function s2(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n,r;let i=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(r=i,r?.$brand==="auto-parseable-tool")?i.$parseRaw(t.arguments):i?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s;return"output_text"===e.type?{...e,parsed:(s=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(s):JSON.parse(s))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s3(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function s3(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class s4 extends t9{constructor(e){super(),ed.add(this),ep.set(this,void 0),ef.set(this,void 0),em.set(this,void 0),eC(this,ep,e,"f")}static createResponse(e,t,s){let n=new s4(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n;let r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eT(this,ed,"m",eg).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eT(this,ed,"m",ey).call(this,r,i);if(n.controller.signal?.aborted)throw new eB;return eT(this,ed,"m",ew).call(this)}[(ep=new WeakMap,ef=new WeakMap,em=new WeakMap,ed=new WeakSet,eg=function(){this.ended||eC(this,ef,void 0,"f")},ey=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eT(this,ed,"m",e_).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eL(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eL(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eL(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eL(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ew=function(){if(this.ended)throw new eL("stream has ended, this shouldn't happen");let e=eT(this,ef,"f");if(!e)throw new eL("request ended without sending any events");eC(this,ef,void 0,"f");let t=function(e,t){return t&&t7(t.text?.format)?s2(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eT(this,ep,"f"));return eC(this,em,t,"f"),t},e_=function(e){let t=eT(this,ef,"f");if(!t){if("response.created"!==e.type)throw new eL(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eC(this,ef,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eL(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eL(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eL(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":eC(this,ef,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eT(this,em,"f");if(!e)throw new eL("stream ended without producing a ChatCompletion");return e}}class s8 extends t2{list(e,t={},s){return this._client.getAPIList(t4`/responses/${e}/input_items`,tB,{query:t,...s})}}class s5 extends t2{constructor(){super(...arguments),this.inputItems=new s8(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s3(e),e))}retrieve(e,t={},s){return this._client.get(t4`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})}delete(e,t){return this._client.delete(t4`/responses/${e}`,{...t,headers:sy([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s2(t,e))}stream(e,t){return s4.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(t4`/responses/${e}/cancel`,t)}}s5.InputItems=s8;class s6 extends t2{create(e,t,s){return this._client.post(t4`/uploads/${e}/parts`,tX({body:t,...s},this._client))}}class s9 extends t2{constructor(){super(...arguments),this.parts=new s6(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(t4`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(t4`/uploads/${e}/complete`,{body:t,...s})}}s9.Parts=s6;let s7=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class ne extends t2{create(e,t,s){return this._client.post(t4`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t4`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(t4`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(t4`/vector_stores/${n}/file_batches/${e}/files`,tB,{query:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await s7(c),await this.createAndPoll(e,{file_ids:o})}}class nt extends t2{create(e,t,s){return this._client.post(t4`/vector_stores/${e}/files`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t4`/vector_stores/${n}/files/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(t4`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t4`/vector_stores/${e}/files`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(t4`/vector_stores/${n}/files/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e3(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(t4`/vector_stores/${n}/files/${e}/content`,tD,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class ns extends t2{constructor(){super(...arguments),this.files=new nt(this._client),this.fileBatches=new ne(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t4`/vector_stores/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t4`/vector_stores/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tB,{query:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t4`/vector_stores/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(t4`/vector_stores/${e}/search`,tD,{body:t,method:"post",...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}ns.Files=nt,ns.FileBatches=ne;let nn=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class nr{constructor({baseURL:e=nn("OPENAI_BASE_URL"),apiKey:t=nn("OPENAI_API_KEY"),organization:s=nn("OPENAI_ORG_ID")??null,project:n=nn("OPENAI_PROJECT_ID")??null,...r}={}){if(ev.set(this,void 0),this.completions=new sN(this),this.chat=new sf(this),this.embeddings=new sD(this),this.files=new sW(this),this.images=new sZ(this),this.audio=new sv(this),this.moderations=new s1(this),this.models=new s0(this),this.fineTuning=new sG(this),this.graders=new sQ(this),this.vectorStores=new ns(this),this.beta=new sT(this),this.batches=new sx(this),this.uploads=new s9(this),this.responses=new s5(this),this.evals=new sU(this),this.containers=new sL(this),void 0===t)throw new eL("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let i={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&tn())throw new eL("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=i.baseURL,this.timeout=i.timeout??eb.DEFAULT_TIMEOUT,this.logger=i.logger??console;let a="warn";this.logLevel=a,this.logLevel=e8(i.logLevel,"ClientOptions.logLevel",this)??e8(nn("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??a,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eC(this,ev,td,"f"),this._options=i,this.apiKey=t,this.organization=s,this.project=n}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return sy([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=t$){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||t$.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=tp;if(void 0!==e.format){if(!tw.call(tf,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tf[n],i=t$.filter;if(("function"==typeof e.filter||tb(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in t_?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":t$.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||t$.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:t$.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:t$.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:t$.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?t$.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:t$.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:t$.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:t$.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:t$.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:t$.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:t$.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:t$.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):tb(r.filter)&&(s=r.filter);let i=[];if("object"!=typeof n||null===n)return"";let a=t_[r.arrayFormat],o="comma"===a&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||tx(i,function e(t,s,n,r,i,a,o,l,c,u,h,d,p,f,m,g,y,w){var _,b;let v,x=t,S=w,$=0,A=!1;for(;void 0!==(S=S.get(tA))&&!A;){let e=S.get(t);if($+=1,void 0!==e){if(e===$)throw RangeError("Cyclic object value");A=!0}void 0===S.get(tA)&&($=0)}if("function"==typeof u?x=u(s,x):x instanceof Date?x=p?.(x):"comma"===n&&tb(x)&&(x=ty(x,function(e){return e instanceof Date?p?.(e):e})),null===x){if(a)return c&&!g?c(s,t$.encoder,y,"key",f):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,t$.encoder,y,"key",f);return[m?.(e)+"="+m?.(c(x,t$.encoder,y,"value",f))]}return[m?.(s)+"="+m?.(String(x))]}let I=[];if(void 0===x)return I;if("comma"===n&&tb(x))g&&c&&(x=ty(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(tb(u))v=u;else{let e=Object.keys(x);v=h?e.sort(h):e}let O=l?String(s).replace(/\./g,"%2E"):String(s),R=r&&tb(x)&&1===x.length?O+"[]":O;if(i&&tb(x)&&0===x.length)return R+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,A=tb(x)?"function"==typeof n?n(R,S):R:R+(d?"."+S:"["+S+"]");w.set(t,$);let O=new WeakMap;O.set(tA,w),tx(I,e(b,A,n,r,i,a,o,l,"comma"===n&&g&&tb(x)?null:c,u,h,d,p,f,m,g,y,O))}return I}(n[t],t,a,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=i.join(r.delimiter),u=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${ts}`}defaultIdempotencyKey(){return`stainless-node-retry-${eN()}`}makeStatusError(e,t,s,n){return eD.generate(e,t,s,n)}buildURL(e,t){let s=new URL(eZ(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n)&&(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tj(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(te(this).debug(`[${l}] sending request`,tt({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eB;let h=new AbortController,d=await this.fetchWithTimeout(a,i,o,h).catch(eM),p=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eB;let r=ej(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return te(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),te(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tt({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),this.retryRequest(n,t,s??l);if(te(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),te(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tt({retryOfRequestLogID:s,url:a,durationMs:p-u,message:d.message})),r)throw new eU;throw new eq({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await th(d.body),te(this).info(`${m} - ${e}`),te(this).debug(`[${l}] response error (${e})`,tt({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";te(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eM(e).message),a=e2(i),o=a?void 0:i;throw te(this).debug(`[${l}] response error (${r})`,tt({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,a,o,d.headers)}return te(this).info(m),te(this).debug(`[${l}] response start`,tt({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:n,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tL(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s,n){let r;let i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e3(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i}=s,a=this.buildURL(r,i);"timeout"in s&&e1("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:o,body:l}=this.buildBody({options:s}),c=this.buildHeaders({options:e,method:n,bodyHeaders:o,retryCount:t});return{req:{method:n,headers:c,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&l instanceof globalThis.ReadableStream&&{duplex:"half"},...l&&{body:l},...this.fetchOptions??{},...s.fetchOptions??{}},url:a,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=sy([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...to(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sy([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:tc(e)}:eT(this,ev,"f").call(this,{body:e,headers:s})}}eb=nr,ev=new WeakMap,nr.OpenAI=eb,nr.DEFAULT_TIMEOUT=6e5,nr.OpenAIError=eL,nr.APIError=eD,nr.APIConnectionError=eq,nr.APIConnectionTimeoutError=eU,nr.APIUserAbortError=eB,nr.NotFoundError=eJ,nr.ConflictError=eH,nr.RateLimitError=eV,nr.BadRequestError=eW,nr.AuthenticationError=eF,nr.InternalServerError=ez,nr.PermissionDeniedError=eX,nr.UnprocessableEntityError=eK,nr.toFile=t0,nr.Completions=sN,nr.Chat=sf,nr.Embeddings=sD,nr.Files=sW,nr.Images=sZ,nr.Audio=sv,nr.Moderations=s1,nr.Models=s0,nr.FineTuning=sG,nr.Graders=sQ,nr.VectorStores=ns,nr.Beta=sT,nr.Batches=sx,nr.Uploads=s9,nr.Responses=s5,nr.Evals=sU,nr.Containers=sL;let ni=(0,eO.promisify)(eI.exec),na=new nr({apiKey:process.env.OPENAI_API_KEY});async function no(e){let{searchParams:t}=new URL(e.url),s=t.get("repo"),n=t.get("token"),r=t.get("questionnaire");if(!s||!n)return new Response(JSON.stringify({error:"Repository and access token are required"}),{status:400});if(!r)return new Response(JSON.stringify({error:"Questionnaire data is required"}),{status:400});let i=new TextEncoder,a=null,o=!1,l=new ReadableStream({start(e){a=e},cancel(){o=!0}}),c=e=>{if(!o&&a)try{a.enqueue(i.encode(`data: ${JSON.stringify({type:"log",message:e})}

`))}catch(e){console.error("Error sending log:",e)}},u=e=>{if(!o&&a)try{a.enqueue(i.encode(`data: ${JSON.stringify({type:"error",message:e})}

`)),a.close(),o=!0}catch(e){console.error("Error sending error message:",e)}},h=()=>{if(!o&&a)try{a.enqueue(i.encode(`data: ${JSON.stringify({type:"complete"})}

`)),a.close(),o=!0}catch(e){console.error("Error sending complete message:",e)}};return(async()=>{try{let e=ek().join(process.cwd(),"temp",s.replace("/","_"));eP().existsSync(e)||eP().mkdirSync(e,{recursive:!0});let t=ek().join(e,".git");if(eP().existsSync(t))c("Repository already exists, pulling latest changes..."),await ni(`cd ${e} && git pull origin main`),c("Latest changes pulled successfully");else{c("Cloning repository...");let t=`https://x-access-token:${n}@github.com/${s}.git`;await ni(`git clone ${t} ${e}`),c("Repository cloned successfully")}let i=new Date().toISOString().replace(/[:.]/g,"-"),a=`improved-landing-${i}`;c(`Creating new branch: ${a}`),await ni(`cd ${e} && git checkout -b ${a}`),c("Searching for landing page...");let o=await nl(e);if(c(`Found landing page at: ${o}`),!o){u("Could not find landing page in the repository");return}c("Reading landing page content...");let l=eP().readFileSync(o,"utf-8");c("Analyzing and improving with AI...");let d=await np(l,o,c,JSON.parse(decodeURIComponent(r)));c("Writing improved content..."),eP().writeFileSync(o,d),c("Committing changes..."),await ni(`cd ${e} && git add .`),await ni(`cd ${e} && git commit -m "Improve landing page with AI enhancements"`),c("Pushing changes to GitHub..."),await ni(`cd ${e} && git push origin ${a}`),c("Cleaning up temporary files..."),eP().rmSync(e,{recursive:!0,force:!0}),c("Improvement completed successfully!"),h()}catch(e){console.error("Error improving repository:",e),u(e instanceof Error?e.message:"Failed to improve repository")}})(),new Response(l,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}async function nl(e){try{let t=["index.html","index.js","index.jsx","index.tsx","page.tsx","page.js","home.html","home.js","home.jsx","home.tsx","landing.html","landing.js","landing.jsx","landing.tsx","main.html","main.js","main.jsx","main.tsx"];for(let s of["","src","app","pages","components","views","templates"]){let n=ek().join(e,s);if(eP().existsSync(n))for(let e of t){let t=ek().join(n,e);if(eP().existsSync(t)&&(console.log("Found potential landing page:",t),await nc(t)))return console.log("Confirmed landing page:",t),t}}let s=["hero","landing","welcome","homepage","main-content","header","navigation","nav","banner","intro"],n=await nu(e);for(let e of n)if(nh(e)&&await nd(e,s))return console.log("Found file with landing page indicators:",e),e;let r=n.filter(nh);if(r.length>0){let e=r.reduce((e,t)=>{let s=eP().statSync(t).size,n=eP().statSync(e).size;return s>n?t:e});return console.log("Found largest frontend file:",e),e}return console.log("No landing page found"),null}catch(e){return console.error("Error finding landing page:",e),null}}async function nc(e){try{let t=eP().readFileSync(e,"utf-8"),s=t.includes("<header")||t.includes("<nav")||t.includes("<main")||t.includes('className="header"')||t.includes('className="nav"')||t.includes('className="main"'),n=["header","nav","hero","banner","main-content","welcome","intro","cta","call-to-action"].some(e=>t.toLowerCase().includes(e)),r=t.includes("useRouter")||t.includes("Link")||t.includes("Route");return s||n||r}catch(e){return console.error("Error checking if file is landing page:",e),!1}}async function nu(e){let t=[];return function e(s){for(let n of eP().readdirSync(s)){let r=ek().join(s,n);eP().statSync(r).isDirectory()?"node_modules"!==n&&".git"!==n&&e(r):t.push(r)}}(e),t}function nh(e){return[".html",".js",".jsx",".tsx"].includes(ek().extname(e).toLowerCase())}async function nd(e,t){try{if(e.includes("/api/")||e.includes("/routes/")||e.includes("/server/"))return!1;let s=eP().readFileSync(e,"utf-8").toLowerCase();if(t.filter(e=>s.includes(e)).length<2)return!1;let n=s.includes("react")||s.includes("next")||s.includes("use client")||s.includes("export default function")||s.includes("export default class"),r=s.includes("<div")||s.includes("className=")||s.includes("style=")||s.includes("return (")||s.includes("return <");return n&&r}catch(e){return console.error("Error checking for landing page indicators:",e),!1}}async function np(e,t,s,n){try{let r=`
      I need to improve a frontend page based on the following requirements:

      Project Goals:
      ${n.goals}

      Important Pages:
      ${n.importantPages}

      Target Metrics:
      ${n.targetMetrics}

      Call-to-Action Buttons:
      ${n.callToActions}

      User Interactions:
      ${n.userInteractions}

      Success Criteria:
      ${n.successCriteria}

      Current page content:
      ${e}

      Please improve this page to:
      1. Optimize for the specified goals and metrics
      2. Enhance the call-to-action buttons
      3. Improve user interactions
      4. Add analytics tracking for the specified metrics
      5. Ensure the page meets the success criteria

      Return the improved code with detailed explanations of the changes made.
    `;s("Sending content to AI for analysis...");let i=(await na.chat.completions.create({model:"gpt-4-turbo-preview",messages:[{role:"system",content:"You are an expert frontend developer specializing in UI/UX optimization and A/B testing. Your task is to improve frontend code based on specific goals and requirements."},{role:"user",content:r}],temperature:.7,max_tokens:4e3})).choices[0].message.content;if(!i)throw Error("No improvement suggestions received from AI");s("AI analysis complete. Applying improvements...");let a=i;return t.endsWith(".html")?a=function(e){let t=`
    <script>
      // User interaction tracking
      const analytics = {
        startTime: Date.now(),
        scrollDepth: 0,
        interactions: [],
        
        init() {
          // Track scroll depth
          window.addEventListener('scroll', () => {
            const scrollPercent = (window.scrollY + window.innerHeight) / document.documentElement.scrollHeight * 100;
            if (scrollPercent > this.scrollDepth) {
              this.scrollDepth = scrollPercent;
              this.logInteraction('scroll', { depth: scrollPercent });
            }
          });

          // Track button clicks
          document.querySelectorAll('button, a, [role="button"]').forEach(element => {
            element.addEventListener('click', (e) => {
              this.logInteraction('click', {
                element: element.tagName,
                text: element.textContent?.trim(),
                id: element.id,
                class: element.className
              });
            });
          });

          // Track form interactions
          document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', (e) => {
              this.logInteraction('form_submit', {
                formId: form.id,
                formAction: form.action
              });
            });
          });

          // Track media interactions
          document.querySelectorAll('video, audio').forEach(media => {
            media.addEventListener('play', () => {
              this.logInteraction('media_play', {
                type: media.tagName,
                id: media.id
              });
            });
          });

          // Track time spent
          setInterval(() => {
            const timeSpent = (Date.now() - this.startTime) / 1000;
            this.logInteraction('time_spent', { seconds: timeSpent });
          }, 30000); // Log every 30 seconds
        },

        logInteraction(type, data) {
          this.interactions.push({
            type,
            data,
            timestamp: new Date().toISOString()
          });
          
          // Send to analytics endpoint
          fetch('/api/analytics', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              type,
              data,
              timestamp: new Date().toISOString()
            })
          }).catch(console.error);
        }
      };

      // Initialize analytics when DOM is loaded
      document.addEventListener('DOMContentLoaded', () => analytics.init());
    </script>
  `;return e.replace("</body>",`${t}
</body>`)}(a):(t.endsWith(".jsx")||t.endsWith(".tsx"))&&(a=function(e){let t=`
    // Analytics component
    const Analytics = () => {
      useEffect(() => {
        const analytics = {
          startTime: Date.now(),
          scrollDepth: 0,
          interactions: [],
          
          init() {
            // Track scroll depth
            const handleScroll = () => {
              const scrollPercent = (window.scrollY + window.innerHeight) / document.documentElement.scrollHeight * 100;
              if (scrollPercent > this.scrollDepth) {
                this.scrollDepth = scrollPercent;
                this.logInteraction('scroll', { depth: scrollPercent });
              }
            };

            // Track button clicks
            const handleClick = (e) => {
              const element = e.target;
              if (element.matches('button, a, [role="button"]')) {
                this.logInteraction('click', {
                  element: element.tagName,
                  text: element.textContent?.trim(),
                  id: element.id,
                  class: element.className
                });
              }
            };

            // Track form interactions
            const handleSubmit = (e) => {
              if (e.target.tagName === 'FORM') {
                this.logInteraction('form_submit', {
                  formId: e.target.id,
                  formAction: e.target.action
                });
              }
            };

            // Track media interactions
            const handleMediaPlay = (e) => {
              if (e.target.matches('video, audio')) {
                this.logInteraction('media_play', {
                  type: e.target.tagName,
                  id: e.target.id
                });
              }
            };

            // Add event listeners
            window.addEventListener('scroll', handleScroll);
            document.addEventListener('click', handleClick);
            document.addEventListener('submit', handleSubmit);
            document.addEventListener('play', handleMediaPlay, true);

            // Track time spent
            const timeInterval = setInterval(() => {
              const timeSpent = (Date.now() - this.startTime) / 1000;
              this.logInteraction('time_spent', { seconds: timeSpent });
            }, 30000);

            // Cleanup function
            return () => {
              window.removeEventListener('scroll', handleScroll);
              document.removeEventListener('click', handleClick);
              document.removeEventListener('submit', handleSubmit);
              document.removeEventListener('play', handleMediaPlay, true);
              clearInterval(timeInterval);
            };
          },

          logInteraction(type, data) {
            this.interactions.push({
              type,
              data,
              timestamp: new Date().toISOString()
            });
            
            // Send to analytics endpoint
            fetch('/api/analytics', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                type,
                data,
                timestamp: new Date().toISOString()
              })
            }).catch(console.error);
          }
        };

        const cleanup = analytics.init();
        return cleanup;
      }, []);

      return null;
    };
  `;return e.replace(/export default function (\w+)/,`${t}

export default function $1`).replace(/return \(/,"return (\n    <>\n      <Analytics />\n      ").replace(/\);/,"\n    </>\n  );")}(a)),a}catch(e){throw console.error("Error in AI improvement:",e),e}}let nf=new eS.AppRouteRouteModule({definition:{kind:e$.x.APP_ROUTE,page:"/api/improve/route",pathname:"/api/improve",filename:"route",bundlePath:"app/api/improve/route"},resolvedPagePath:"/Users/arminforoughi/Documents/test2/xfeatures/frontend-improver-web/app/api/improve/route.ts",nextConfigOutput:"",userland:ex}),{requestAsyncStorage:nm,staticGenerationAsyncStorage:ng,serverHooks:ny,headerHooks:nw,staticGenerationBailout:n_}=nf,nb="/api/improve/route";function nv(){return(0,eA.patchFetch)({serverHooks:ny,staticGenerationAsyncStorage:ng})}},95419:(e,t,s)=>{e.exports=s(30517)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[638],()=>s(35001));module.exports=n})();